<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QMD åœ˜çµä¸€å¿ƒ Boss å¤§æŒ‘æˆ°</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #f39c12; --danger: #e74c3c; --success: #27ae60; --disabled: #555; }
        body { background: #121212; color: white; font-family: "PingFang TC", sans-serif; margin: 0; overflow-x: hidden; }
        .hidden { display: none !important; }
        #display-view { padding: 20px; text-align: center; }
        .hurt-flash { background: rgba(231, 76, 60, 0.4) !important; transition: 0.1s; }
        .q-card { background: rgba(0,0,0,0.85); padding: 30px; border-radius: 20px; margin: 20px auto; max-width: 900px; border: 3px solid var(--primary); box-shadow: 0 0 30px rgba(243, 156, 18, 0.5); }
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; font-size: 28px; text-align: left; }
        #boss-container { position: relative; display: inline-block; margin: 40px auto; min-height: 320px; }
        #boss-img { width: 320px; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); filter: drop-shadow(0 0 15px rgba(255,255,255,0.3)); }
        .shake { animation: heavy-shake 0.5s both; }
        @keyframes heavy-shake { 0%, 100% {transform: translateX(0);} 20% {transform: translateX(-20px) rotate(-8deg);} 40% {transform: translateX(20px) rotate(8deg);} 60% {transform: translateX(-20px) rotate(-8deg);} 80% {transform: translateX(20px) rotate(8deg);} }
        #hp-wrapper { width: 85%; background: #222; height: 45px; border: 4px solid #fff; margin: 20px auto; border-radius: 25px; overflow: hidden; position: relative; }
        #hp-bar { width: 100%; height: 100%; background: linear-gradient(90deg, #ff416c, #ff4b2b); transition: width 1.2s ease-out; }
        #dmg-text { position: absolute; top: -30px; left: 50%; transform: translateX(-50%); font-size: 80px; font-weight: 900; color: #ff3e3e; opacity: 0; pointer-events: none; z-index: 100; text-shadow: 4px 4px 0 #000; }
        .dmg-float { animation: float-up 1.2s forwards; }
        @keyframes float-up { 0% { opacity: 1; transform: translate(-50%, 0) scale(0.5); } 100% { opacity: 0; transform: translate(-50%, -120px) scale(1.2); } }
        .stat-container { display: flex; flex-direction: column; align-items: center; margin-top: 20px; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; }
        .stat-row { display: flex; align-items: center; width: 100%; max-width: 750px; margin: 8px 0; font-size: 22px; }
        .stat-label { width: 180px; font-weight: bold; text-align: left; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .stat-bar-bg { flex-grow: 1; background: #333; height: 24px; border-radius: 12px; margin: 0 15px; overflow: hidden; }
        .stat-bar-fill { height: 100%; background: #777; transition: width 1s ease-out; }
        .correct-fill { background: var(--success) !important; box-shadow: 0 0 15px var(--success); }
        .stat-value { width: 120px; text-align: right; font-size: 20px; color: #aaa; }
        .correct-text { color: var(--success) !important; font-weight: 900; }
        #name-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #121212; z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        input[type="text"] { padding: 15px; font-size: 20px; border-radius: 10px; border: none; margin-bottom: 20px; width: 80%; max-width: 300px; text-align: center; }
        .player-btn { background: linear-gradient(145deg, #f39c12, #e67e22); color: white; border: none; padding: 25px; font-size: 24px; border-radius: 20px; font-weight: bold; width: 100%; cursor: pointer; box-shadow: 0 5px #d35400; transition: 0.2s; }
        .player-btn:disabled { background: #555; box-shadow: none; transform: translateY(5px); cursor: not-allowed; }
        #bgm-control { position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.6); color: white; border: 1px solid #555; padding: 12px; border-radius: 10px; z-index: 1000; cursor: pointer; }
    </style>
</head>
<body>

<audio id="game-bgm" src="BGM.mp3" loop></audio>
<audio id="victory-bgm" src="BGM_Victory.mp3"></audio>

<div id="name-overlay" class="hidden">
    <h2 style="color: var(--primary); font-size: 30px;">ğŸ›¡ï¸ æˆ°å£«åŠ å…¥æˆ°å ´ ğŸ›¡ï¸</h2>
    <input type="text" id="player-name-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„åå­—...">
    <button class="player-btn" style="width: 200px;" onclick="saveName()">åŠ å…¥æˆ°é¬¥</button>
</div>

<div id="player-view" class="hidden">
    <div id="player-waiting" style="margin-top: 150px; text-align: center;">
        <h2 id="welcome-msg" style="font-size: 32px;">æº–å‚™ä¸­...</h2>
        <p id="wait-msg" style="font-size: 22px; color: #f1c40f;">ç­‰å¾…æŒ‡æ®å®˜ç™¼å¸ƒä»»å‹™...</p>
    </div>
    <div id="player-q-zone" class="hidden">
        <div id="p-q-timer" style="text-align: center; font-size: 30px; color: #e74c3c; font-weight: bold; margin-bottom: 10px;">â³ å‰©é¤˜æ™‚é–“: 10s</div>
        <h3 id="p-title" style="text-align: center; font-size: 28px; padding: 10px; min-height: 80px;">ä»»å‹™è¼‰å…¥ä¸­...</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px;">
            <button class="player-btn q-btn" onclick="submitAns('A')">A. <span id="pa"></span></button>
            <button class="player-btn q-btn" onclick="submitAns('B')">B. <span id="pb"></span></button>
            <button class="player-btn q-btn" onclick="submitAns('C')">C. <span id="pc"></span></button>
            <button class="player-btn q-btn" onclick="submitAns('D')">D. <span id="pd"></span></button>
        </div>
    </div>
</div>

<div id="display-view" class="hidden">
    <button id="bgm-control" onclick="toggleBGM()">ğŸµ å•Ÿå‹• BGM</button>
    <div style="display: flex; justify-content: center; align-items: center; gap: 30px;">
        <h1 id="round-num" style="font-size: 55px; margin: 10px 0; color: var(--primary);">READY?</h1>
        <div id="d-timer" style="font-size: 55px; font-weight: bold; color: #e74c3c;"></div>
    </div>
    <div id="boss-container">
        <div id="dmg-text"></div>
        <img id="boss-img" src="Boss_normal.png">
    </div>
    <div id="hp-wrapper">
        <div id="hp-bar"></div>
        <div style="position: absolute; width:100%; top:0; line-height:45px; font-weight:900; font-size: 24px;">HP: <span id="hp-text">12000</span> / 12000</div>
    </div>
    <div id="mvp-announcement" class="q-card hidden" style="border-color: gold;">
        <h2 style="color: gold; font-size: 45px; margin: 10px 0;">ğŸ† æˆ°å ´è‹±é›„æ¦œ ğŸ†</h2>
        <div id="mvp-list" style="font-size: 30px; line-height: 1.4;"></div>
    </div>
    <div id="display-q-box" class="q-card hidden">
        <h2 id="d-title" style="margin-top:0; font-size: 40px; border-bottom: 2px solid #555; padding-bottom: 15px;"></h2>
        <div class="option-grid" id="d-options"></div>
    </div>
    <div id="msg-box" style="margin-top: 20px;"></div>
    <div id="vote-count" style="color: #888; font-size: 22px; margin-top: 15px;">å·²é›†çµæˆ°å£«: 0</div>
</div>

<div id="admin-view" class="hidden" style="text-align: center; padding: 20px;">
    <h2>æŒ‡æ®å®˜ä½œæˆ°é¢æ¿</h2>
    <div id="admin-btns" style="background:#222; padding:20px; border-radius:15px; margin-bottom: 20px;"></div>
    <button onclick="calculateResult()" style="background:var(--success); color:white; width:85%; padding:25px; font-size:32px; border:none; border-radius:15px; font-weight: bold; cursor: pointer;">ğŸ’¥ å…¨å“¡ç™¼å‹•æ”»æ“Šï¼</button>
    <br><br><br>
    <button onclick="resetGame()" style="background:#c0392b; color:white; padding:12px 24px; border:none; border-radius:5px; cursor: pointer;">ğŸ’£ é‡ç½®æˆ°å ´ (å…¨é«”é‡ç½®)</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDwwKME2_neH-VxZObTStJ_uRuJI_-C-tw",
        authDomain: "department-boss-battle.firebaseapp.com",
        databaseURL: "https://department-boss-battle-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "department-boss-battle",
        storageBucket: "department-boss-battle.firebasestorage.app",
        messagingSenderId: "112990000902",
        appId: "1:112990000902:web:5b003355322134537e3087"
    };

    const questionBank = {
        1: { t: "è«‹å•ä»Šå¤©çš„ä¸»æŒäººå¸¥å—?", o: {A:"å¸¥", B:"å¾ˆå¸¥", C:"è¶…å¸¥", D:"ç‰¹åˆ¥å¸¥"}, a: "ALL" },
        2: { t: "Moxaåœ¨å“ªè£¡?", o: {A:"æ¿æ©‹", B:"æ–°èŠ", C:"ä¸­å’Œ", D:"æ°¸å’Œ"}, a: "B" },
        3: { t: "æˆ‘å€‘æ˜¯ç”šéº¼è‚¡ä»½æœ‰é™å…¬å¸?", o: {A:"101", B:"202", C:"303", D:"404"}, a: "D" },
        4: { t: "CEå…¨ç¨±?", o: {A:"Common Era", B:"Civil Engineer", C:"Component Engineer", D:"Computer Engineer"}, a: "C" },
        5: { t: "ä»Šå¹´å¼·èª¿çš„ä¸»é¡Œæ˜¯?", o: {A:"å”ä½œ", B:"å”åŠ›è»Š", C:"å­«å”å¿—", D:"å”å”å”"}, a: "A" },
        6: { t: "CAæœ€æ‰›çš„ç”·äººæ˜¯èª°?", o: {A:"Boozer", B:"Booger", C:"Booder", D:"Booker"}, a: "A" },
        7: { t: "CEå¤©æ‰ç•«æ‰‹æ˜¯èª°?", o: {A:"Daneil", B:"Dennis", C:"Demmis", D:"Deccis"}, a: "B" },
        8: { t: "CAè¬ è¨€è£½é€ è€…æ˜¯èª°?", o: {A:"Naoh", B:"Nhao", C:"Noah", D:"Noha"}, a: "C" },
        9: { t: "CAä¹‹æ¯æ˜¯èª°?", o: {A:"Lica", B:"Lisa", C:"Liya", D:"Liwa"}, a: "B" },
        10: { t: "CAå°çŒ´æ˜¯èª°?", o: {A:"Tiffiya", B:"Tiffant", C:"Tiffjia", D:"Tiffany"}, a: "D" }
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const role = new URLSearchParams(window.location.search).get('role') || 'player';
    const uid = localStorage.getItem('game_uid') || Math.random().toString(36).substring(7);
    localStorage.setItem('game_uid', uid);

    let isResetting = false;
    db.ref('resetTrigger').on('value', snap => {
        if (snap.val() === true && !isResetting) {
            isResetting = true;
            if(role === 'player') localStorage.removeItem('boss_player_name');
            setTimeout(() => { location.reload(); }, 100);
        }
    });

    function saveName() {
        const name = document.getElementById('player-name-input').value.trim();
        if(!name) return alert("è«‹è¼¸å…¥æˆ°å£«åï¼");
        localStorage.setItem('boss_player_name', name);
        db.ref('players/' + uid).set(name);
        document.getElementById('name-overlay').classList.add('hidden');
        document.getElementById('player-view').classList.remove('hidden');
    }

    if(role === 'player' && !localStorage.getItem('boss_player_name')) {
        document.getElementById('name-overlay').classList.remove('hidden');
    } else if(role === 'player') {
        document.getElementById('player-view').classList.remove('hidden');
        db.ref('players/' + uid).set(localStorage.getItem('boss_player_name'));
    } else if(role === 'display') {
        document.getElementById('display-view').classList.remove('hidden');
    } else if(role === 'admin') {
        document.getElementById('admin-view').classList.remove('hidden');
        const container = document.getElementById('admin-btns');
        for(let i=1; i<=10; i++) container.innerHTML += `<button onclick="changeQ(${i})" style="margin:5px; padding:12px; cursor:pointer;">ä»»å‹™ ${i}</button>`;
    }

    function toggleBGM() {
        const bgm = document.getElementById('game-bgm');
        const vbgm = document.getElementById('victory-bgm');
        if (bgm.paused && vbgm.paused) { bgm.play(); document.getElementById('bgm-control').innerText = "â¸ æš«åœéŸ³æ•ˆ"; }
        else { bgm.pause(); vbgm.pause(); document.getElementById('bgm-control').innerText = "â–¶ æ’­æ”¾éŸ³æ•ˆ"; }
    }

    let hasSubmitted = false;
    let lastQNum = -1;
    let currentGlobalTimeLeft = 10; // è¿½è¹¤ç›®å‰å‰©é¤˜ç§’æ•¸

    db.ref('gameState').on('value', snap => {
        const state = snap.val() || { hp: 12000, status: 'waiting' };
        currentGlobalTimeLeft = state.timeLeft || 0; // åŒæ­¥ç§’æ•¸
        
        if (state.q !== lastQNum || state.status === 'answering') {
            if (state.status === 'answering' && state.q !== lastQNum) {
                hasSubmitted = false;
            }
            lastQNum = state.q;
        }

        if(state.timeLeft !== undefined && state.status === 'answering') {
            const timerStr = state.timeLeft > 0 ? `â³ ${state.timeLeft}s` : "âŒ› æ™‚é–“åˆ°ï¼";
            if(role === 'display') document.getElementById('d-timer').innerText = timerStr;
            if(role === 'player') {
                const pTimer = document.getElementById('p-q-timer');
                if(pTimer) pTimer.innerText = timerStr;
                if(state.timeLeft <= 0) {
                    document.querySelectorAll('.q-btn').forEach(b => b.disabled = true);
                    document.getElementById('p-title').innerHTML = "<span style='color:var(--danger)'>ä»»å‹™æ™‚é–“å·²åˆ°ï¼ä¸å¯ä½œç­”</span>";
                }
            }
        } else {
            if(role === 'display') document.getElementById('d-timer').innerText = "";
        }

        if(role === 'display') {
            const bossImg = document.getElementById('boss-img');
            document.getElementById('hp-bar').style.width = (state.hp/12000*100) + "%";
            document.getElementById('hp-text').innerText = state.hp;
            if(state.hp <= 0) {
                bossImg.src = "Boss_hurt.png"; bossImg.style.transform = "scale(0) rotate(720deg)";
                confetti({ particleCount: 300, spread: 160 });
                findMVP(); document.getElementById('round-num').innerText = "VICTORY!";
                document.getElementById('msg-box').innerHTML = ""; 
            } else {
                bossImg.src = state.hp <= 6000 ? "Boss_angry.png" : "Boss_normal.png";
            }

            if(state.status === 'answering') {
                const q = questionBank[state.q];
                document.getElementById('mvp-announcement').classList.add('hidden');
                document.getElementById('display-q-box').classList.remove('hidden');
                document.getElementById('d-title').innerText = q.t;
                document.getElementById('d-options').innerHTML = `<div>A: ${q.o.A}</div><div>B: ${q.o.B}</div><div>C: ${q.o.C}</div><div>D: ${q.o.D}</div>`;
                document.getElementById('msg-box').innerHTML = "";
                document.getElementById('round-num').innerText = "é›†æ°£ä¸­...";
            } else if(state.status === 'result') {
                document.getElementById('display-q-box').classList.add('hidden');
                if(state.lastDmg > 0) {
                    bossImg.classList.add('shake');
                    const dmgText = document.getElementById('dmg-text');
                    dmgText.innerText = "-" + state.lastDmg;
                    dmgText.classList.add('dmg-float');
                    document.getElementById('display-view').classList.add('hurt-flash');
                    setTimeout(() => { 
                        bossImg.classList.remove('shake'); dmgText.classList.remove('dmg-float'); 
                        document.getElementById('display-view').classList.remove('hurt-flash');
                    }, 1000);
                }
                const stats = state.stats || { A:0, B:0, C:0, D:0 };
                const total = (stats.A + stats.B + stats.C + stats.D) || 1;
                const currentQ = questionBank[state.q];
                document.getElementById('msg-box').innerHTML = `
                    <div style="font-size: 38px; font-weight: bold; text-shadow: 2px 2px 4px #000;">
                        <div style="color: #2ecc71;">ä»»å‹™æˆåŠŸç‡ï¼š${state.correctRate || 0}%</div>
                        <div style="font-size: 50px; color: #e74c3c; margin-bottom:15px;">é€ æˆå‚·å®³ï¼š${state.lastDmg}</div>
                    </div>
                    <div class="stat-container">
                        <div style="font-size:24px; color:var(--primary); margin-bottom:15px; font-weight:bold;">ğŸ“Š æˆ°å£«é›†æ°£åˆ†ä½ˆ</div>
                        ${['A','B','C','D'].map(opt => {
                            const isAns = (currentQ.a === "ALL" || currentQ.a === opt);
                            return `<div class="stat-row">
                                <div class="stat-label ${isAns ? 'correct-text' : ''}">${opt}: ${currentQ.o[opt]} ${isAns ? 'âœ…' : ''}</div>
                                <div class="stat-bar-bg"><div class="stat-bar-fill ${isAns ? 'correct-fill' : ''}" style="width: ${(stats[opt]/total*100)}%"></div></div>
                                <div class="stat-value ${isAns ? 'correct-text' : ''}">${stats[opt]} äºº (${Math.round(stats[opt]/total*100)}%)</div>
                            </div>`;
                        }).join('')}
                    </div>`;
                document.getElementById('round-num').innerText = "æ”»æ“ŠæˆåŠŸ!";
            }
        }

        if(role === 'player') {
            const q = questionBank[state.q];
            if(state.status === 'answering' && !hasSubmitted) {
                document.getElementById('player-waiting').classList.add('hidden');
                document.getElementById('player-q-zone').classList.remove('hidden');
                document.getElementById('p-title').innerText = q.t;
                document.getElementById('pa').innerText = q.o.A; document.getElementById('pb').innerText = q.o.B;
                document.getElementById('pc').innerText = q.o.C; document.getElementById('pd').innerText = q.o.D;
                if(state.timeLeft > 0) document.querySelectorAll('.q-btn').forEach(b => b.disabled = false);
            } else {
                document.getElementById('player-q-zone').classList.add('hidden');
                document.getElementById('player-waiting').classList.remove('hidden');
                if (hasSubmitted) {
                    document.getElementById('wait-msg').innerText = "é›†æ°£å®Œæˆï¼Œæº–å‚™æ”»æ“Šï¼ğŸ’¥";
                } else if (state.status === 'result') {
                    document.getElementById('wait-msg').innerText = "ä»»å‹™çµç®—ä¸­...";
                } else {
                    document.getElementById('wait-msg').innerText = "ç­‰å¾…æŒ‡æ®å®˜ç™¼å¸ƒä»»å‹™...";
                }
            }
        }
    });

    db.ref('players').on('value', snap => {
        if(role === 'display') document.getElementById('vote-count').innerText = `å·²é›†çµæˆ°å£«: ${snap.numChildren()}`;
    });

    let timerInterval = null;
    function changeQ(num) {
        clearInterval(timerInterval);
        db.ref('responses').remove();
        let timeLeft = 10;
        db.ref('gameState').update({ q: num, status: 'answering', lastDmg: 0, stats: null, timeLeft: timeLeft });
        timerInterval = setInterval(() => {
            timeLeft--;
            if(timeLeft <= 0) { clearInterval(timerInterval); db.ref('gameState/timeLeft').set(0); }
            else { db.ref('gameState/timeLeft').set(timeLeft); }
        }, 1000);
    }

    function submitAns(ans) {
        hasSubmitted = true;
        // æ–°å¢è¨˜éŒ„ timeLeft (å‰©é¤˜ç§’æ•¸)
        db.ref('responses/' + uid).set({ 
            ans: ans, 
            name: localStorage.getItem('boss_player_name'),
            timeBonus: currentGlobalTimeLeft 
        });
        document.getElementById('player-q-zone').classList.add('hidden');
        document.getElementById('player-waiting').classList.remove('hidden');
        document.getElementById('wait-msg').innerText = "é›†æ°£å®Œæˆï¼Œæº–å‚™æ”»æ“Šï¼ğŸ’¥";
    }

    function calculateResult() {
        clearInterval(timerInterval);
        db.ref().once('value', snap => {
            const data = snap.val();
            const resps = data.responses || {};
            const qNum = data.gameState.q;
            const qData = questionBank[qNum];
            db.ref('history').push({ qNum: qNum, players: resps });
            const players = Object.values(resps);
            if(players.length === 0) return alert("æ²’äººé›†æ°£ï¼");
            const stats = { A:0, B:0, C:0, D:0 };
            players.forEach(p => { if(stats[p.ans] !== undefined) stats[p.ans]++; });
            let correctCount = (qData.a === "ALL") ? players.length : players.filter(p => p.ans === qData.a).length;
            let rate = Math.round((correctCount / players.length) * 100);
            let dmg = Math.floor((rate / 100) * 1500);
            db.ref('gameState').update({ status: 'result', hp: Math.max(0, data.gameState.hp - dmg), lastDmg: dmg, correctRate: rate, stats: stats, timeLeft: 0 });
        });
    }

    function findMVP() {
        db.ref('history').once('value', snap => {
            const history = snap.val(); if(!history) return;
            const scores = {}; // æ ¼å¼: { "åå­—": { count: ç­”å°æ•¸, totalTime: ç¸½å‰©é¤˜ç§’æ•¸ } }
            
            Object.values(history).forEach(round => {
                const correctAns = questionBank[round.qNum].a;
                if(!round.players) return;
                Object.values(round.players).forEach(pData => {
                    if(pData.name) {
                        if(!scores[pData.name]) scores[pData.name] = { count: 0, totalTime: 0 };
                        if(correctAns === "ALL" || pData.ans === correctAns) {
                            scores[pData.name].count += 1;
                            scores[pData.name].totalTime += (pData.timeBonus || 0);
                        }
                    }
                });
            });

            // é›™é‡æ’åºï¼š1. ç­”å°æ¬¡æ•¸(å¤§åˆ°å°) 2. ç¸½å‰©é¤˜ç§’æ•¸(å¤§åˆ°å°)
            const sorted = Object.entries(scores).sort((a,b) => {
                if(b[1].count !== a[1].count) return b[1].count - a[1].count;
                return b[1].totalTime - a[1].totalTime;
            });

            const mvpBox = document.getElementById('mvp-announcement');
            const mvpList = document.getElementById('mvp-list');
            mvpBox.classList.remove('hidden');
            if(sorted.length > 0) {
                mvpList.innerHTML = sorted.slice(0, 8).map((p, i) => {
                    let icon = i === 0 ? "ğŸ¥‡" : (i === 1 ? "ğŸ¥ˆ" : (i === 2 ? "ğŸ¥‰" : "ğŸ–ï¸"));
                    return `<div style="margin:10px 0; display:flex; justify-content:space-between; padding:0 30px;">
                        <span>${icon} <span style="color:white">${p[0]}</span></span>
                        <span style="color:var(--primary)">${p[1].count} æ¬¡ (${p[1].totalTime}s)</span>
                    </div>`;
                }).join('');
            }
        });
    }

    function resetGame() {
        if(confirm("ç¢ºå®šé‡ç½®ï¼Ÿé€™æœƒè®“æ‰€æœ‰ç«¯é»é‡æ–°æ•´ç†ã€‚")) {
            clearInterval(timerInterval);
            db.ref('resetTrigger').set(true).then(() => {
                db.ref('/').update({
                    gameState: { q:0, status:'waiting', hp:12000, lastDmg: 0, correctRate: 0, stats: null, timeLeft: 10 },
                    responses: null, history: null, players: null, resetTrigger: false
                });
            });
        }
    }
</script>
</body>
</html>
